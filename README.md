

# REST API

## Введение 

REST API (Representational State Transfer Application Programming Interface) – это архитектурный стиль для разработки веб-сервисов, который основан на принципах REST. REST API позволяет взаимодействовать с удаленным сервером и обмениваться данными между клиентом и сервером посредством HTTP-протокола.

REST API предоставляет набор эндпоинтов (URL-адресов), по которым можно отправлять запросы и получать ответы. Каждый эндпоинт соответствует определенному ресурсу (например, пользователю, товару, заказу и т.д.), и с помощью различных HTTP-методов (GET, POST, PUT, DELETE) можно выполнять операции с этими ресурсами (получение, создание, обновление, удаление).

REST API обычно использует формат данных JSON или XML для представления информации, которая передается между клиентом и сервером. Он также может поддерживать аутентификацию и авторизацию для обеспечения безопасности при работе с данными.

REST API широко применяется в различных областях, включая веб-разработку, мобильные приложения, социальные сети, интернет-магазины и другие системы, где требуется взаимодействие с удаленными серверами и обмен данными.

Если вы хотите более подробно узнать что такое REST API, можете прочитать статью на хабре [ССЫЛКА](https://habr.com/ru/articles/590679/)

## Задача

Мы рассмотрим использование REST API на примере [задания](https://prof23.mcrpo.ru/uploaded_files/concurs_doc/4668/champ/task.pdf?t=1698908836) олимпиады ["Московские мастера 2023"](https://prof23.mcrpo.ru/) по [компетенции](https://prof23.mcrpo.ru/kompetentsii/#comp_list) Веб-технологии с использованием технологии NodeJS

## Установка

Для работы проекта необходимы следующие программы: `VS Code`, `NodeJS/npm`, `nix`, `git`

______________________________________________________________


1. Открываем в Visual Studio Code папку, где будет наш проект. В нашем случае, папка называется server.

2. Открываем консоль в Visual Studio Code с помощью комбинации клавиш `Ctrl + ~`.

3. В открытой консоли вводим команду `npm init`. Эта команда запускает интерактивный процесс, который поможет создать файл `package.json` для вашего проекта.

4. Нажимаем Enter, пока консоль не успокоится. Вы должны продолжать нажимать Enter, пока `npm` не закончит вопросы и не создаст файл `package.json`.

5. Получаем файл `package.json` с содержимым:

```json
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.ts",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

### Установка необходимых пакетов (библиотек)

Мы будем устанавливать список пакетов нужных для задания, (ваш список может отличаться)

Пакеты основные (По заданию): `class-validator, config, cors, cross-env, dotenv, express, express-validator, jsonwebtoken, mysql2, reflect-metadata, typeorm`
Пакеты дополнительные (Упростят нам жизнь в дальнейшем): `@types/cors, @types/express, @types/node, typescript`

Если у вас возникнут трудности с пониманием пакетов в процессе работы с проектом - можете прочитать про них [дополнительно](https://docs.google.com/document/d/1VsGqtwd7SSIadfWjbytE5FGQazv0T0YhrcVFEvH06Zk/edit?usp=sharing)

______________________________________________________________


Для установки в консоли пишем:

```bash
npm install class-validator config cors cross-env dotenv express express-validator jsonwebtoken mysql2 reflect-metadata typeorm
```

```bash
npm install -D @types/cors @types/express @types/node typescript
```

Ждём когда пакеты установятся

Файл `package.json` обновился:

```json
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.ts",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "class-validator": "^0.14.0",
    "config": "^3.3.9",
    "cors": "^2.8.5",
    "cross-env": "^7.0.3",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "express-validator": "^7.0.1",
    "jsonwebtoken": "^9.0.2",
    "mysql2": "^3.6.5",
    "reflect-metadata": "^0.1.13",
    "typeorm": "^0.3.17"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.3",
    "typescript": "^5.3.2"
  }
}
```



### Создание нужных файлов

В файле `package.json` меняем свойства :
```js
  "main": "index.ts",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
```

на

```js
  "main": "dist/index.ts",
  "scripts": {
    "dev": "clear && tsc && npm run running",
    "build": "tsc",
    "running": "node ./dist/index.ts"
  },
```
Свойство `main` указывает на тот файл, который будет запущен, когда ваш пакет будет установлен как зависимость в другом пакете. В данном случае, вы меняете его на `dist/index.ts`, что означает, что основной файл вашего проекта будет находиться в папке `dist`.

Свойство `scripts` содержит скрипты, которые можно запустить с помощью команды `npm run <script>`.

Также вы добавляете три новых скрипта:

`dev`: Этот скрипт сначала очищает консоль, затем компилирует ваш TypeScript код в JavaScript с помощью tsc, и затем запускает скрипт running.
`build`: Этот скрипт компилирует ваш TypeScript код в JavaScript с помощью tsc.
`running`: Этот скрипт запускает ваш основной файл JavaScript с помощью Node.js.

*** Эти изменения позволяют вам легко запускать ваш проект в режиме разработки, компилировать его и запускать скомпилированный код. ***

Итоговый файл `package.json` который должен получиться:

```js
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "dist/index.ts",
  "scripts": {
    "dev": "clear && tsc && node ./dist/index.ts"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "class-validator": "^0.14.0",
    "config": "^3.3.9",
    "cors": "^2.8.5",
    "cross-env": "^7.0.3",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "express-validator": "^7.0.1",
    "jsonwebtoken": "^9.0.2",
    "mysql2": "^3.6.5",
    "reflect-metadata": "^0.1.13",
    "typeorm": "^0.3.17"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.3",
    "typescript": "^5.3.2"
  }
}
```

______________________________________________________________


В корне проекта нужно создать файл `tsconfig.json`

Его содержимое:

```js
{
  "compilerOptions": {
    "lib": [
      "es5",
      "es6",
      "dom"
    ],
    "target": "es5",
    "module": "commonjs",
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "outDir": "./dist"
  }
}
```

Давайте разберем, что делает каждое из этих свойств:

- lib: Это опция указывает, какие библиотеки TypeScript должны быть включены в компиляцию. В данном случае, включены es5, es6 и dom.
- target: Это опция указывает версию ECMAScript, которую TypeScript должен использовать для компиляции. В данном случае, используется es5.
module: Это опция указывает, какой модульный стандарт использовать. В данном случае, используется commonjs.
moduleResolution: Это опция указывает, как TypeScript должен разрешать модули. В данном случае, используется node.
emitDecoratorMetadata: Эта опция включает или отключает генерацию метаданных для декораторов. В данном случае, включена.
experimentalDecorators: Эта опция включает или отключает экспериментальную поддержку декораторов. В данном случае, включена.
esModuleInterop: Эта опция включает или отключает совместимость с ES модулями. В данном случае, включена.
skipLibCheck: Эта опция включает или отключает проверку типов в библиотеках. В данном случае, включена.
outDir: Эта опция указывает, в какую папку должны быть выведены скомпилированные файлы. В данном случае, в папку ./dist 3.
В целом, эти настройки позволяют вам контролировать, как TypeScript компилирует ваш код, и адаптировать его под ваши конкретные потребности.



## Работа с базой данных

Запуск БД описывается в [Установка](#Установка)


### Установка Базы данных

```bash
direnv allow
```

### Запуск базы данных

```bash
devenv up
```

### Создание моделей

Создаётся файл в папке `/src/entity/`

Пример `/src/entity/Rooms`

```js
import { Entity, Column, PrimaryGeneratedColumn } from "typeorm"

@Entity()
export class Rooms {
    @PrimaryGeneratedColumn()
    id: Number

    @Column()
    name: String

    @Column()
    desc_data: String
}
```

и необходимо добавить его в массив моделей в файл `/src/config.ts`, там где создаётся база данных

```js
entities: [Admins, Tokens, Rooms, Clients, Hotels],
```

## Маршруты и контроллеры

### Маршруты

Маршруты в Express.js определяют, как приложение отвечает на клиентский запрос к конкретному адресу (URI). Они связывают HTTP действия (GET, POST, PUT, DELETE, etc.)

Все маршруты храняться в `/src/routes/`

Главный роутер находится в файле `/src/routes/index.ts`

Его мы используем в файле `/src/index.ts`

### Контроллеры

Контроллеры в Express.js - это функции, которые обрабатывают входящие HTTP-запросы.

Храняться в папке `/src/controllers/`


## Тестирование

Postman - это инструмент для создания, тестирования, документирования, публикации и обслуживания API. Он позволяет создавать коллекции запросов к любому API, применять к ним разные окружения, настраивать мок-серверы, писать автотесты на JavaScript, анализировать и визуализировать результаты запросов 2.

Начало работы с Postman

Скачайте и установите Postman с официального сайта 2.
После установки откройте приложение и создайте новое рабочее пространство. В левой боковой панели вы можете организовывать свое пространство 5.
Создайте новую коллекцию. Коллекция - это группа связанных запросов. Обычно API описывается в одной коллекции, но если вы хотите, то нет никаких ограничений сделать по-другому 5.
Внутри коллекции вы можете создать папки для группировки запросов по смыслу выполняемых действий. Например, вы можете создать папку для первой версии своего API — "v1", а внутри сгруппировать запросы по смыслу выполняемых действий — "Order & Checkout", "User profile" и т. п 5.
Создайте новый запрос внутри папки. Запрос создается в конструкторе, где вы можете выбрать метод (GET, POST, PUT, DELETE и т.д.), указать URL и отправить запрос 5.
Работа с переменными в Postman

В Postman можно создавать переменные разных уровней: глобальные, коллекции, окружения и локальные. Глобальные переменные применяются ко всему рабочему пространству, переменные коллекции создаются внутри конкретной коллекции и работают только внутри нее, переменные окружения задаются на уровне окружения, а локальные переменные существуют на уровне скриптов, которые выполняются при отправке запросов 2.

Тестирование API с помощью Postman

Postman позволяет создавать тесты для проверки ответов от сервера. Тестировщик может определить ожидаемые значения и условия, чтобы автоматически проверить, что API возвращает правильные результаты. Вы можете прописывать свои тесты во вкладке «Tests» для запроса, где можно создавать скрипты, делать проверки и многое другое 5.

Запуск всей коллекции Postman

Если вы хотите запустить не один запрос, а пройтись сразу по нескольким, либо же запустить даже всю коллекцию - перейдите в опции коллекции/папки и выберите «Run». Далее, выберите, какие запросы вы хотите прогнать и можете поменять порядок их запуска 5.
1. [Как пользоваться программой Postman](https://timeweb.com/ru/community/articles/kak-polzovatsya-postman)
2. [Postman для REST API запросов. Быстрый старт и переменные](https://www.youtube.com/watch?v=A_jGdrGRLd0)

## Развертывание

В разработке

## Поддержка и обслуживание

В разработке

## Пакеты используемые в проекте, но не допущенные по тз

- jsonwebtoken
- express-validator

## Курсы для изучения

1. [Node.js and Express.js - Full Course](https://www.youtube.com/watch?v=Oe421EPjeBE)
  - [github repo node-express-course](https://github.com/john-smilga/node-express-course)
2. [Node.js, Express, TypeORM, PostgreSQL: CRUD Rest API](https://codevoweb.com/node-express-typeorm-postgresql-rest-api/)
